package com.cg.banking.services;


import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import com.cg.banking.exception.InvalidAccountId;
import com.cg.banking.exception.InvalidUserId;
import com.cg.banking.exception.LessThanMinimum;
import com.cg.banking.model.Account;
import com.cg.banking.model.User;
import com.cg.banking.repo.AccountRepo;
import com.cg.banking.repo.UserRepo;

@Component
public class AccountServiceImpl implements AccountService {
@Autowired
private AccountRepo repo;
@Autowired
private UserRepo userRepo;
	@Override
	public Account create(Account account) {
		// TODO Auto-generated method stub
		repo.save(account);
		return account;
	}

	@Override
	public String delete(int accountId)throws InvalidAccountId,LessThanMinimum {
		// TODO Auto-generated method stub
		Account acc=repo.findById(accountId).orElseThrow(()->new InvalidAccountId("this accountId is not valid"));
		repo.delete(acc);
		return "SUCCESSFULLY DELETED";
	}

	@Override
	public double deposit(int accountId, double amount)throws InvalidAccountId {
		// TODO Auto-generated method stub
		double newAmount=repo.findById(accountId).orElseThrow(()->new InvalidAccountId("this accountId is not valid")).getBalance()+amount;
		repo.findById(accountId).get().setBalance(newAmount);
		return newAmount;
	}

	@Override
	public double withdraw(int accountId, double amount)throws InvalidAccountId,LessThanMinimum {
		// TODO Auto-generated method stub
		double newAmount=repo.findById(accountId).orElseThrow(()->new InvalidAccountId("this accountId is not valid")).getBalance()-amount;
		if(newAmount<0) {
			throw new LessThanMinimum ("BALANCE LESS THAN AMOUNT");
		}
		repo.findById(accountId).get().setBalance(newAmount);
		return newAmount;
	}

	@Override
	public User createUser(User user) {
		userRepo.save(user);
		return user;
		
	}

//	@Override
//	public boolean login(int userId, int pin) {
//		// TODO Auto-generated method stub
//		
//	}

	@Override
	public int setPin(int userId, int pin)throws InvalidUserId {
		// TODO Auto-generated method stub
		userRepo.save(userRepo.findById(userId).orElseThrow(()-> new InvalidUserId("Invalid userId")).setPin(pin));
		
		return pin;
	}

	@Override
	public String updateMobile(int userId, String mobile)throws InvalidUserId {
		// TODO Auto-generated method stub
		userRepo.findById(userId).orElseThrow(()-> new InvalidUserId("Invalid userId")).setMobileNumber(mobile);
		return mobile;
	}

	@Override
	public User getUser(int userId)throws InvalidUserId {
		// TODO Auto-generated method stub
		return userRepo.findById(userId).orElseThrow(()-> new InvalidUserId("Invalid userId"));
	}

}
